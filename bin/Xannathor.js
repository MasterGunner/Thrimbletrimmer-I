var Xannathor;!function(e){exports=e}(Xannathor||(Xannathor={}));var fs=require("fs"),GoogleAuth=require("google-auth-library"),Xannathor;!function(e){var t;!function(e){function t(e){console.log(e)}function i(e){var t=!1;return e.vidID&&e.start&&e.end&&e.title&&e.description&&e.start<e.end&&e.title.length<=91&&(t=!0),t}function n(t,i){var n=function(t,n){if(t)e.log("Error Authenticating OAuth Token:"),e.log(t),i(!1,null);else{var a=n.getPayload(),s=a.email,o=fs.readFileSync("../Resources/AuthenticatedUserList.txt").toString().split("\n");o.indexOf(s)>=0?(e.log("User Authenticated: "+s),i(!0,e.generateSessionId(a))):(e.log("User Not Authenticated: "+s),i(!1,null))}};try{(new((new GoogleAuth).OAuth2)).verifyIdToken(t,null,n)}catch(a){e.log(a)}}function a(e){return"1234567890"}function s(e){return"1234567890"==e?!0:!1}e.log=t,e.validateVideoSubmission=i,e.auth=n,e.generateSessionId=a,e.validateSessionId=s}(t=e.Utilities||(e.Utilities={}))}(Xannathor||(Xannathor={}));var fs=require("fs"),Xannathor;!function(e){var t;!function(t){function i(t){var i=null;try{for(var n=JSON.parse(fs.readFileSync("../Videos/videolist.json","utf8")),a=0;a<n.length;a++)if(n[a].vidID==t){var s=n[a],o={vidID:s.vidID,src:s.src,type:s.type,title:s.title,description:s.description,framerate:s.framerate,width:s.width,height:s.height};i=o;break}}catch(r){e.Utilities.log(r)}return i}function n(t){var i=!1;if(e.Utilities.validateVideoSubmission(t))try{i=!0}catch(n){e.Utilities.log(n)}return i}t.getVideo=i,t.submitVideo=n}(t=e.WubloaderIntegration||(e.WubloaderIntegration={}))}(Xannathor||(Xannathor={}));var express=require("express"),bodyParser=require("body-parser"),Utilities=Xannathor.Utilities,Wubloader=Xannathor.WubloaderIntegration,app=express();app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!1})),app.use(express["static"]("../EditorPage")),app.use(express["static"]("../Videos")),app.get("/",function(e,t){t.sendFile("../Resources/default.html",{root:__dirname})}),app.post("/tokensignin",function(e,t){Utilities.auth(e.body.id_token,function(e,i){if(e){var n={Response:"User Authenticated",SessionId:i};t.json(n)}else{var n={Response:"User Not Authenticated",SessionId:i};t.json(n)}})}),app.get("/getwubs/:a?",function(e,t){if(Utilities.validateSessionId(e.query.SessionId)){var i=Wubloader.getVideo(e.params.a);i?t.json(i):t.sendStatus(400)}else t.sendStatus(401)}),app.post("/setwubs",function(e,t){Utilities.log(e.body),Utilities.validateSessionId(e.body["extraMetadata[0][SessionId]"])?Wubloader.submitVideo(e.body)?t.send("Recieved Video Edits"):t.sendStatus(500):t.sendStatus(401)}),app.listen(1337),Utilities.log("Server running at http://127.0.0.1:1337/");