<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

	<title>Eustace W. Thrimbletrimmer Editing Suite</title>
  
	<script src="scripts/jquery-2.1.3.min.js"></script>
	<script src="scripts/jquery-ui-1.11.4/jquery-ui.js"></script>
	<script src="scripts/wubPlayerControls.js"></script>
	<script src="scripts/wubEditorControls.js"></script>
	<script src="https://apis.google.com/js/platform.js" async defer></script>
	<link rel="stylesheet" href="scripts/jquery-ui-1.11.4/jquery-ui.css">
	<link rel="stylesheet" href="styles/wubPlayerControls.css">
	<link rel="stylesheet" href="styles/wubEditorControls.css">
	<meta name="google-signin-client_id" content="345276493482-r84m2giavk10glnmqna0lbq8e1hdaus0.apps.googleusercontent.com">
</head>
<body>
	<div id="Sign-in">
		<div class="g-signin2" data-onsuccess="onSignIn"></div>
		<span id="g-signin-response"></span>
		<script type="text/javascript">
			function onSignIn(googleUser) {
				var id_token = googleUser.getAuthResponse().id_token;
				var xhr = new XMLHttpRequest();
				xhr.open('POST', '/tokensignin');
				xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
				xhr.onload = function() {
					console.log(xhr.responseText);
					$('#g-signin-response').text(xhr.responseText);
					if(xhr.responseText.indexOf("User Authenticated") === 0) {
						$('#Sign-in').hide();
						$('#EditorContent').show();
					}
				};
				xhr.send('id_token=' + id_token);
			}
		</script>
	</div>
	<div id="EditorContent" style="display:none">	
		<a href="#" onclick="signOut();" style="float:right;">Sign out</a>
		<script>
		  function signOut() {
			var auth2 = gapi.auth2.getAuthInstance();
			auth2.signOut().then(function () {
			  console.log('User signed out.');
			  window.location.reload();
			});
		  }
		</script>
	</div>
	<script type="text/javascript">
		var path = window.location.protocol + '//' + window.location.hostname;
		var thumbnailInfo = {};
		
		var getExtraData = function() {
			var extraData = [thumbnailInfo];
			return extraData;
		}
		
		var CallForWubs = function(Callback) {
			if(window.location.search.match(/video=(.*?)(&|$)/i)) {
				var videoID = window.location.search.match(/video=(.*?)(&|$)/i)[1];
				$.get('/getwubs/'+videoID,function(data) { Callback(data); },'json');
			}
		};
		
		var InsertVideo = function(wubs) {
			$('#EditorContent').append('<video id="wubPlayer" width="'+wubs.width+'" height="'+wubs.height+'" style="padding-top:2px;" vidID='+wubs.vidID+'>' +
											'<source src="'+wubs.src+'" type="'+wubs.type+'" />' +
											'Your browser does not support HTML5 video.' +
										'</video>');
			$('#wubPlayer').wVideo({startOffset:10});
			$('#wubPlayer').wEditor({submitLoc:'/setwubs', startOffset:10, endOffset:10, vidID:wubs.vidID, title:wubs.title, description:wubs.description, extraMetadata:getExtraData});
			//Add Thumbnail selection/editing functionality.
			$('#SubmitButton').before('<input type="button" id="SetThumbnail" value="Set Thumbnail"/>');
			$('#SetThumbnail').click(function() {
				var thumbnailEditor = window.open('ThumbnailEditor.html','Thumbnail Editor','width=800, height=600, scrollbars=yes');
				thumbnailEditor.video_source = wubs.src;
				thumbnailEditor.video_type = wubs.type;
				thumbnailEditor.video_width = wubs.width;
				thumbnailEditor.video_height = wubs.height;
				thumbnailEditor.video_framerate = wubs.framerate;
			});
		};
		
		
		var PageSetup = function() {
			CallForWubs(InsertVideo);
		};
		
		PageSetup();
	</script>
</body>
</html>
